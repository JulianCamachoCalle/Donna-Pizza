<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Especificaciones de la Pizza</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>

<div class="container mt-5">
    <!-- Detalles del Producto -->
    <div class="product-card d-flex align-items-center">
        <div class="product-image">
            <img src="/img/pizzas/predeterminada.jpg" alt="Imagen de la Pizza" class="img-fluid" id="pizza-image">
        </div>
        <div class="product-info">
            <h3 id="pizza-name">Nombre de la Pizza</h3>
            <p id="pizza-description">Descripción de los ingredientes de la pizza.</p>

            <!-- Selección de tamaño -->
            <div class="size-options mt-3">
                <h5>Selecciona el tamaño:</h5>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="size" id="size-familiar" value="Familiar" checked>
                    <label class="form-check-label" for="size-familiar">Familiar - S/. <span id="price-familiar">0</span></label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="size" id="size-media" value="Media">
                    <label class="form-check-label" for="size-media">Media - S/. <span id="price-media">0</span></label>
                </div>
            </div>

            <!-- Cantidad -->
            <div class="quantity-container d-flex align-items-center mt-3">
                <button class="btn btn-outline-secondary" onclick="updateQuantity(-1)">-</button>
                <input id="quantity" type="text" value="1" readonly class="form-control text-center mx-2" style="width: 50px;">
                <button class="btn btn-outline-secondary" onclick="updateQuantity(1)">+</button>
            </div>

            <!-- Botones de acción -->
            <button class="btn btn-danger mt-3" onclick="addToCart()">Agregar al Carrito</button>
            <button class="btn btn-primary mt-3" onclick="buyPizza()">Comprar</button>
        </div>
    </div>
</div>

<!-- Carrito de compras -->
<div id="cart-container" class="container mt-5" style="display: none;">
    <h4>Carrito de Compras</h4>
    <ul id="cart-items" class="list-group"></ul>
    <a href="/fromclient" class="btn btn-success mt-3">Proceder al Pago</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script>
    // Obtener detalles de la pizza desde la API
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const pizzaId = urlParams.get('id');

        if (pizzaId) {
            fetch(`/api/v1/pizzas/${pizzaId}`)
                .then(response => {
                    if (!response.ok) throw new Error('Error al obtener la pizza');
                    return response.json();
                })
                .then(data => {
                    // Cargar la imagen, nombre y descripción de la pizza
                    document.getElementById('pizza-image').src = `/img/pizzas/${data.nombre}.jpg`;
                    document.getElementById('pizza-name').textContent = data.nombre;
                    document.getElementById('pizza-description').textContent = data.descripcion;

                    // Asignar precios, asegurándose de que los valores sean numéricos
                    document.getElementById('price-familiar').textContent = parseFloat(data.precioFamiliar).toFixed(2);
                    document.getElementById('price-media').textContent = data.precio;
                })
                    .catch(error => console.error('Error:', error));
        }
    });

    // Función para actualizar cantidad
    function updateQuantity(amount) {
        const quantityInput = document.getElementById('quantity');
        let currentQuantity = parseInt(quantityInput.value);
        currentQuantity += amount;
        if (currentQuantity < 1) currentQuantity = 1;
        quantityInput.value = currentQuantity;
    }

    // Función para agregar al carrito
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    function addToCart() {
        const productName = document.getElementById('pizza-name').textContent;
        const selectedSize = document.querySelector('input[name="size"]:checked').value;
        const productPrice = selectedSize === 'Familiar' ? document.getElementById('price-familiar').textContent : document.getElementById('price-media').textContent;
        const quantity = document.getElementById('quantity').value;

        // Añadir al carrito
        cart.push({ name: productName, size: selectedSize, price: `S/. ${productPrice}`, quantity: quantity });
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();
    }

    // Función para eliminar un producto del carrito
    function removeFromCart(index) {
        // Eliminar el producto del arreglo cart y actualizar localStorage
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI(); // Actualizar la interfaz del carrito
    }

    // Actualizar la interfaz del carrito
    function updateCartUI() {
        const cartContainer = document.getElementById('cart-container');
        const cartItemsList = document.getElementById('cart-items');
        cartItemsList.innerHTML = ''; // Limpiar la lista actual

        // Crear los elementos del carrito
        cart.forEach((item, index) => {
            const li = document.createElement('li');
            li.className = "list-group-item d-flex justify-content-between align-items-center";
            li.textContent = `${item.quantity} x ${item.name} (${item.size}) - ${item.price}`;

            // Botón de eliminación
            const removeButton = document.createElement('button');
            removeButton.className = "btn btn-outline-danger btn-sm";
            removeButton.textContent = "Eliminar";
            removeButton.onclick = () => removeFromCart(index); // Pasar el índice del elemento a eliminar
            li.appendChild(removeButton); // Añadir el botón al elemento de la lista

            cartItemsList.appendChild(li);
        });

        // Mostrar u ocultar el contenedor del carrito
        cartContainer.style.display = cart.length > 0 ? 'block' : 'none';
    }

    // Cargar carrito al cargar la página
    window.onload = function() {
        updateCartUI();
    };
</script>

</body>
</html>
